{% extends "base_generic.html" %}
{% load scheduletags %}

{% load static %}


{% block add_to_head %}
  <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'fontawesomefree/css/brands.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

  <style>
      a.addClassLink {
      border-radius: 50%;
      height: 40px;
      width: 40px;
      display: inline-flex;
      background-color: maroon;
      justify-content: center;
      justify-items: center;
      margin-top: 10px;
    }

    a.addClassLink:link{
      text-decoration: none;
    }

    div.buttons {
    display: inline-flex;
    float: right;
    height: 100%;
    }
  </style>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<div class="row">
  <div class="col-lg-9 col-12">
    <div id="calendar"></div>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          timeZone: 'America/New_York',
          initialView: 'dayGridMonth',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          eventSources: [
            {
              url: "{% url 'notes:eventapi' %}",
              method: 'GET',
              extraParams: {
                calendar_slug: '{{user.username}}',

              },
              failure: function() {
                alert('There was an error while fetching events!');
              }
            },
            {
              url: "{% url 'notes:todoapi' %}",
              method: 'GET',
              extraParams: {
                calendar_slug: '{{user.username}}',

              },
              failure: function() {
                alert('There was an error while fetching events!');
              }
            }
          ],
          eventClick: function(info) {
            window.open( '/class/' + info.event.title, target="_self");
          },
        });
        calendar.render();
      });

    </script> 
  </div>
  <div class="col-lg-3 col-12">
    <div class="row">
      <div class="col-lg-12 col-6 mb-lg-3">
        <h1>Class List</h1>
        <div class="list-group">
          {% for c in classes %}
            <a class="list-group-item list-group-item-action" style="background-color: {{ c.calendar_event.color_event }}" href="/class/{{ c.name }}/">{{ c.name }}</a>
          {% endfor %}
        </div>
        <h2>
          <a href="{% url 'notes:add_event' %}" class="addClassLink">
            <i class="fa-solid fa-plus" style="color: white; align-self: center; justify-self: center; "></i>
          </a>
          <a href="{% url 'notes:import_class' %}" class="addClassLink">
            <i class="fa-solid fa-file-import" style="color: white; align-self: center; justify-self: center; "></i>
          </a>
        </h2>
      </div>
      {% if archived_classes %}
        <div class="mb-5">
        <h1>Archived Classes</h1>
        <div class="class-list">

        </div>
        <div class="list-group">
          {% for c in archived_classes %}
          <div class="list-group-item" style="background-color: {{ c.calendar_event.color_event }}"
            href="/class/{{ c.name }}/">
            {{ c.name }}
            <div class="buttons">
              <a href ="{% url 'notes:restore_class' c.id %}">
                <i class="fa-solid fa-trash-restore" style="color: grey; margin-right: 10px;"></i>
              </a>
              <a href="{% url 'notes:delete_class' c.id %}">
                <i class="fa-solid fa-trash" style="color: grey"></i>
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {%endif%}

      <div class="col-lg-12 col-6 mb-lg-3">
        <h1>To-do List</h1>
        <form action = '' method='post'>
          {% csrf_token %}
          {% for t in ToDos %}
          <a class="list-group-item list-group-item-action" 
            style="background-color: {{ t.cls.calendar_event.color_event }}"  href="{% url 'notes:edit_todo' t.cls.id %}?todoid={{t.id}}">
            {{t.title}}
            <input type="checkbox" value={{t.id}} name="checkbox_data" {% if t.completed %} checked {% endif %}><br>
          </a>
          {% endfor %}
          <input type="submit" value="submit">
        </form>
      </div>
    </div>
  </div>
</div>
{% else %}
<h1>Welcome to Studious</h1>
<h2>Your new home for notetaking.</h2>
{% endif %}

{% endblock %}
